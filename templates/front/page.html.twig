{% extends 'front/base.html.twig' %}

{% block head %}
    {{ include('front/page-meta.html.twig') }}
    <meta property="og:type" content="article">
{% endblock %}

{% block main %}
    {% for message in app.session.flashbag.get('OK') %}
        <p class="message">{{ message }}</p>
    {% endfor %}

    <div id="ariane">
        {{ ariane(page.id) }}
    </div>

    <h1 class="titre-page">{{ page.titre }}</h1>

    {% if page.affichageDatePublication or page.affichageAuteur or page.categories is not empty %}
        <p class="infos-page">
            {% if page.affichageDatePublication %}
                {{ 'Publié le'|trans }}
                {{ page.datePublication|date("d/m/Y") }}
            {% endif %}
            {% if page.affichageAuteur %}
                {{ 'par'|trans }}
                {% if page.auteur is not empty %}
                    {{ page.auteur }}
                {% else %}
                    <i>{{ "Compte supprimé"|trans }}</i>
                {% endif %}
            {% endif %}
            {% if page.categories is not empty %}
                {% if page.affichageDatePublication %}
                    {{ 'dans les catégories'|trans }}
                {% endif %}
                {% for categorie in page.categories %}
                    <a class="bouton-categorie" href="
                        {% if langues|length > 1 %}
                            {{ path('voirCategorieLocale', { '_locale': categorie.typeCategorie.langue.abreviation, 'urlTypeCategorie': categorie.typeCategorie.seo.url, 'urlCategorie': categorie.seo.url }) }}
                        {% else %}
                            {{ path('voirCategorie', { 'urlTypeCategorie': categorie.typeCategorie.seo.url, 'urlCategorie': categorie.seo.url }) }}
                        {% endif %}
                    "><i class="fas fa-tag"></i>{{ categorie.nom }}</a>
                {% endfor %}
            {% endif %}
        </p>
    {% endif %}

    {{ blocs(page)|raw }}

    {% if page.affichageCommentaires %}
        <div class="blocCommentaires">
            {# NB commentaires #}
            {% set nbCommentaires = 0 %}
            {% for commentaire in commentaires %}
                {% if commentaire.corbeille == false and commentaire.valide == true %}
                    {% set nbCommentaires = nbCommentaires + 1 %}
                {% endif %}
            {% endfor %}
            {# NB commentaires #}

            <h2>Commentaires sur "{{ page.titre }}" ({{ nbCommentaires }})</h2>

            {% for message in app.session.flashbag.get('comOK') %}
                <p class="message">{{ message }}</p>
            {% endfor %}

            <p class="blocCommentaires-ajout">Ajouter un commentaire<i class="fas fa-angle-down mls"></i></p>
            <div class="blocCommentaires-formulaire">
                {{ form(form) }}
            </div>

            {% for commentaire in commentaires if commentaire.corbeille == false and commentaire.valide == true %}
                <div class="commentaire">
                    <p>Par <strong>{{ commentaire.auteur }}</strong> le {{ commentaire.date|date("d/m/Y") }} à {{ commentaire.date|date("G:i") }}</p>
                    <p class="pas">{{ commentaire.contenu|raw }}</p>
                </div>
            {% endfor %}
        </div>
    {% endif %}

{% endblock %}